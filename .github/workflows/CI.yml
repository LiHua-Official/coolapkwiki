name: Coolapk Wiki CI

on: push

jobs:
  build:

    runs-on: ubuntu-latest

    steps:

        - uses: actions/checkout@v2
        - name: 拉取文章
          run: |
              git clone https://github.com/Coolapk-Fan/wiki.wiki.git source/_posts
        - uses: actions/setup-node@v2-beta
          with:
              node-version: '12'
              check-latest: true
        - uses: actions/cache@v2
          with:
              path: ~/.npm
              key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
              restore-keys: ${{ runner.os }}-node-
        - name: 设置SSH私钥
          env:
              DEPLOY_KEY: ${{ secrets.DEPLOY_KEY }}
          run: |
              mkdir ~/.ssh
              echo $DEPLOY_KEY > ~/.ssh/coolapkwiki
              chmod 600 ~/.ssh/coolapkwiki
              ssh-keyscan github.com >> ~/.ssh/known_hosts

        - name: 设置Git信息
          run: |
              git config user.name github-actions
              git config user.email github-actions@github.com
        
        - name: 部署
          run: |
              hexo d --debug
